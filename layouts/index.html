{{- /* Custom homepage for Colorful Cardboard (overrides PaperMod) */ -}}
{{- define "main" -}}

<section class="cc-hero" style="--cc-hero-bg: url('/images/cards-pile-1.jpg');">
  <div class="cc-hero__inner">
    <p class="cc-hero__kicker">Data-driven Pokemon card investing</p>
    <h1 class="cc-hero__title">Colorful Cardboard</h1>
    <p class="cc-hero__tagline">Premium analysis for collectors who want real, repeatable edge.</p>
    <div class="cc-hero__cta">
      <a class="cc-btn cc-btn--primary" href="/start-here/">Start Here →</a>
      <a class="cc-btn cc-btn--ghost" href="/categories/market-analysis/">Browse Market Analysis</a>
    </div>
  </div>
</section>

<section class="cc-section cc-filter">
  <div class="cc-filter__bar" role="tablist" aria-label="Filter posts by category">
    <button class="cc-pill is-active" type="button" data-filter="all">All</button>
    <button class="cc-pill" type="button" data-filter="market-analysis">Market Analysis</button>
    <button class="cc-pill" type="button" data-filter="card-picks">Card Picks</button>
    <button class="cc-pill" type="button" data-filter="set-reviews">Set Reviews</button>
    <button class="cc-pill" type="button" data-filter="beginners-guide">Beginner's Guide</button>
  </div>
</section>

<section class="cc-section cc-latest">
  <div class="cc-section__head">
    <h2>Latest Analysis</h2>
    <a class="cc-section__link" href="/posts/">View all →</a>
  </div>

  <div class="cc-post-grid cc-post-grid--home" id="cc-posts">
    {{- $pages := where .Site.RegularPages "Type" "in" (slice "posts" "post") -}}
    {{- $pages = where $pages "Draft" false -}}
    {{- range first 12 (sort $pages "Date" "desc") -}}
      {{- $cat := "" -}}
      {{- with .Params.categories -}}
        {{- $cat = (index . 0) -}}
      {{- end -}}
      <article class="cc-post-card" data-cat="{{ $cat }}">
        <a class="cc-post-card__link" href="{{ .RelPermalink }}">
          {{- $img := "" -}}
          {{- with .Params.cover -}}
            {{- $img = .image -}}
          {{- end -}}
          {{- if $img -}}
            <div class="cc-post-card__thumb" style="--cc-thumb-bg: url('{{ $img }}');"></div>
          {{- else -}}
            <div class="cc-post-card__thumb cc-post-card__thumb--fallback"></div>
          {{- end -}}

          <div class="cc-post-card__body">
            <div class="cc-post-card__meta">
              <time datetime="{{ .Date }}">{{ .Date.Format "Jan 2, 2006" }}</time>
              {{- if $cat -}}
                <span class="cc-dot">•</span>
                <span class="cc-post-card__cat">{{ $cat }}</span>
              {{- end -}}
            </div>
            <h3 class="cc-post-card__title">{{ .Title }}</h3>
            {{- with .Params.description -}}
              <p class="cc-post-card__desc">{{ . }}</p>
            {{- end -}}
          </div>
        </a>
      </article>
    {{- end -}}
  </div>

  <script>
    (function () {
      const bar = document.querySelector('.cc-filter__bar');
      const posts = Array.from(document.querySelectorAll('#cc-posts .cc-post-card'));
      if (!bar || posts.length === 0) return;

      function setActive(btn) {
        bar.querySelectorAll('.cc-pill').forEach(b => b.classList.remove('is-active'));
        btn.classList.add('is-active');
      }

      function applyFilter(cat) {
        posts.forEach(p => {
          const pcat = (p.getAttribute('data-cat') || '').toLowerCase();
          const show = cat === 'all' || pcat === cat;
          p.style.display = show ? '' : 'none';
        });
      }

      bar.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        const cat = btn.getAttribute('data-filter');
        setActive(btn);
        applyFilter(cat);
      });
    })();
  </script>
</section>

<section class="cc-newsletter">
  <div class="cc-newsletter__inner">
    <div class="cc-newsletter__copy">
      <h2>Get new analysis in your inbox</h2>
      <p>One email per week. Market moves, rotation watchlists, and the best ideas.</p>
    </div>

    <form class="cc-newsletter__form" action="#" method="post">
      <label class="sr-only" for="cc-email">Email</label>
      <input id="cc-email" name="email" type="email" placeholder="you@example.com" autocomplete="email" />
      <button type="submit">Subscribe</button>
      <small class="cc-newsletter__fine">Placeholder form — wiring coming soon.</small>
    </form>
  </div>
</section>

{{- end -}}
